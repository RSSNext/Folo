.shiki-wrapper {
  @apply overflow-hidden;

  pre {
    @apply bg-transparent;
  }

  &.transparent {
    :global {
      .shiki,
      code {
        @apply !bg-transparent;
      }
    }
  }

  :global {
    .shiki {
      @apply !m-0 !bg-transparent !px-0;

      font-family:
        "OperatorMonoSSmLig Nerd Font",
        "Cascadia Code PL",
        "FantasqueSansMono Nerd Font",
        "Operator Mono",
        JetBrainsMono,
        "Fira Code Retina",
        "Fira Code",
        "Consolas",
        Monaco,
        "Hannotate SC",
        monospace,
        -apple-system,
        system-ui,
        sans-serif;
    }

    pre {
      @apply !m-0 overflow-auto px-4 py-3;

      font-size: 0.875em;
      line-height: 1.6;

      /* Custom scrollbar */
      &::-webkit-scrollbar {
        @apply h-1.5 w-1.5;
      }

      &::-webkit-scrollbar-track {
        @apply bg-transparent;
      }

      &::-webkit-scrollbar-thumb {
        @apply rounded-full bg-fill-tertiary transition-colors;

        &:hover {
          @apply bg-fill-secondary;
        }
      }
    }

    pre code {
      @apply flex flex-col;
    }

    .line {
      @apply block px-4 transition-colors duration-100;

      & > span:last-child {
        @apply mr-4;
      }

      /* Expand the row without content */
      &::after {
        content: " ";
      }

      /* Subtle hover effect on lines */
      &:hover {
        @apply bg-fill/10;
      }
    }

    .highlighted,
    .diff {
      @apply relative break-all;

      &::before {
        @apply absolute left-0 top-0 h-full w-0.5;
        content: "";
      }
    }

    .diff.add {
      @apply bg-green/10;

      &::before {
        @apply bg-green;
      }

      &::after {
        content: " +";
        @apply absolute left-1.5 text-xs font-semibold text-green;
      }
    }

    .diff.remove {
      @apply bg-red/10;

      &::before {
        @apply bg-red;
      }

      &::after {
        content: " -";
        @apply absolute left-1.5 text-xs font-semibold text-red;
      }
    }

    .highlighted {
      @apply bg-accent/10;

      &::before {
        @apply bg-accent;
      }
    }
  }

  pre {
    @apply rounded-none;
  }
}
